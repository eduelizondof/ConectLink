import{g as x,u as P,a as S,_ as C,b as $,c as L,d as N}from"./ProductsCatalog.vue_vue_type_script_setup_true_lang-Dan4SQyP.js";import{D as j}from"./download-Dhrr9OQm.js";import{E as B}from"./eye-CMurwkyG.js";import{d as E,c as n,e as d,k as l,l as p,v as u,f as _,x as M,p as V,g as y,m as c}from"./vendor-CwJ9eRpz.js";const A={class:"relative rounded-2xl border shadow-lg overflow-hidden",style:{"max-height":"600px"}},F={class:"absolute inset-0 z-0 overflow-hidden rounded-2xl"},D={key:0,class:"absolute inset-0 overflow-hidden rounded-2xl"},H=["src"],O=["src"],X={class:"px-4 py-6"},G={class:"flex justify-center mt-6"},Q=E({__name:"ProfilePreview",props:{profile:{},organization:{}},setup(b){const i=b,{getBrandColor:h}=S();console.log("ProfilePreview - Organization data:",{organization:i.organization,products:i.organization.products,productCategories:i.organization.productCategories,productSections:i.organization.productSections,productsLength:i.organization.products?.length,sectionsLength:i.organization.productSections?.length,hasProductCategories:"productCategories"in i.organization,hasProductSections:"productSections"in i.organization,organizationKeys:Object.keys(i.organization)});const s=n(()=>{const o=x(),e=i.profile.settings||{};return{...o,...e,background_type:e.background_type||o.background_type,background_color:e.background_color||o.background_color,background_gradient_start:e.background_gradient_start||o.background_gradient_start,background_gradient_end:e.background_gradient_end||o.background_gradient_end,background_gradient_direction:e.background_gradient_direction||o.background_gradient_direction,background_animated_media:e.background_animated_media,background_animated_media_type:e.background_animated_media_type,background_animated_overlay_opacity:e.background_animated_overlay_opacity??o.background_animated_overlay_opacity,primary_color:e.primary_color||o.primary_color,text_color:e.text_color||o.text_color,text_secondary_color:e.text_secondary_color||o.text_secondary_color,card_style:e.card_style||o.card_style,card_background_color:e.card_background_color||o.card_background_color,card_border_radius:e.card_border_radius||o.card_border_radius,card_shadow:e.card_shadow??o.card_shadow,card_border_color:e.card_border_color||o.card_border_color,card_glow_enabled:e.card_glow_enabled??o.card_glow_enabled,card_glow_color:e.card_glow_color||o.card_glow_color,card_glow_color_secondary:e.card_glow_color_secondary||o.card_glow_color_secondary,card_glow_variant:e.card_glow_variant||o.card_glow_variant,card_glow_duration:e.card_glow_duration??o.card_glow_duration,card_glow_opacity:e.card_glow_opacity??o.card_glow_opacity,photo_style:e.photo_style||o.photo_style,photo_size:e.photo_size||"md",social_style:e.social_style||o.social_style,social_size:e.social_size||o.social_size,social_colored:e.social_colored??o.social_colored,show_profile_photo:e.show_profile_photo??o.show_profile_photo}}),{backgroundStyle:w}=P(s),m=n(()=>{const o=i.profile.social_links||i.profile.socialLinks||[],r=(i.profile.custom_links||i.profile.customLinks||[]).map((a,t)=>({...a,sort_order:a.sort_order??t}));return{id:i.profile.id,name:i.profile.name,slug:void 0,photo:i.profile.photo?`/storage/${i.profile.photo}`:void 0,job_title:i.profile.job_title,slogan:i.profile.slogan,bio:i.profile.bio,is_primary:!1,views_count:0,settings:s.value,social_links:o.map(a=>({id:a.id,platform:a.platform,url:a.url,label:a.label||a.display_label||a.platform,icon:a.icon,brand_color:a.brand_color||h(a.platform)})),custom_links:r.map(a=>({id:a.id,title:a.title,url:a.url,description:a.description,icon:a.icon,thumbnail:a.thumbnail,image:a.image,image_position:a.image_position,image_shape:a.image_shape,button_color:a.button_color,text_color:a.text_color,is_highlighted:a.is_highlighted||!1})),floating_alerts:[]}}),z=n(()=>({id:0,name:i.organization.name,slug:"",logo:i.organization.logo,logo_url:i.organization.logo_url||(i.organization.logo?`/storage/${i.organization.logo}`:void 0),type:"business",description:void 0})),f=n(()=>{const o=i.organization.products||[];return console.log("ProfilePreview - Normalizing products:",o),o.filter(e=>e.is_active!==!1).map(e=>({id:e.id,name:e.name,slug:e.slug,short_description:e.short_description,description:e.description,price:e.price?parseFloat(e.price):void 0,sale_price:e.sale_price?parseFloat(e.sale_price):void 0,currency:e.currency||"MXN",image:e.image?`/storage/${e.image}`:e.image_url||void 0,gallery:e.gallery,external_url:e.external_url,whatsapp_message:e.whatsapp_message,is_featured:e.is_featured||!1,is_available:e.is_available??!0,category:e.category?{id:e.category.id,name:e.category.name,slug:e.category.slug}:void 0}))}),k=n(()=>{let o=i.organization.productCategories||[];if(o.length===0){const e=new Map;(i.organization.products||[]).forEach(a=>{if(a.category&&a.category.id){e.has(a.category.id)||e.set(a.category.id,{id:a.category.id,name:a.category.name,slug:a.category.slug,products_count:0});const t=e.get(a.category.id);t.products_count=(t.products_count||0)+1}}),o=Array.from(e.values())}return console.log("ProfilePreview - Normalizing categories:",o),o.map(e=>({id:e.id,name:e.name,slug:e.slug,products_count:e.products_count||0}))}),v=n(()=>{let o=i.organization.productSections||[];if(o.length===0){const e=new Map;(i.organization.products||[]).forEach(a=>{a.sections&&Array.isArray(a.sections)&&a.sections.length>0&&a.sections.forEach(t=>{t&&t.id&&(e.has(t.id)||e.set(t.id,{id:t.id,title:t.title||t.name,slug:t.slug,description:t.description,icon:t.icon,products:[]}),e.get(t.id).products.push(a))})}),o=Array.from(e.values())}return console.log("ProfilePreview - Normalizing sections:",o),o.filter(e=>e.is_active!==!1).map(e=>({id:e.id,title:e.title,slug:e.slug,description:e.description,icon:e.icon,products:(e.products||[]).map(r=>({id:r.id,name:r.name,slug:r.slug,short_description:r.short_description,description:r.description,price:r.price?parseFloat(r.price):void 0,sale_price:r.sale_price?parseFloat(r.sale_price):void 0,currency:r.currency||"MXN",image:r.image?`/storage/${r.image}`:r.image_url||void 0,gallery:r.gallery,external_url:r.external_url,whatsapp_message:r.whatsapp_message,is_featured:r.is_featured||!1,is_available:r.is_available??!0,category:r.category?{id:r.category.id,name:r.category.name,slug:r.category.slug}:void 0}))}))}),g=n(()=>!0);return(o,e)=>(c(),d("div",A,[e[2]||(e[2]=l("div",{class:"absolute inset-x-0 top-0 h-6 bg-black rounded-t-2xl flex items-center justify-center z-10"},[l("div",{class:"w-20 h-4 bg-black rounded-full"})],-1)),l("div",F,[s.value.background_type==="animated"&&s.value.background_animated_media?(c(),d("div",D,[s.value.background_animated_media_type==="video"?(c(),d("video",{key:0,src:`/storage/${s.value.background_animated_media}`,autoplay:"",loop:"",muted:"",playsinline:"",class:"absolute inset-0 w-full h-full object-cover"},null,8,H)):(c(),d("img",{key:1,src:`/storage/${s.value.background_animated_media}`,alt:"Background",class:"absolute inset-0 w-full h-full object-cover"},null,8,O)),(s.value.background_animated_overlay_opacity||0)>0?(c(),d("div",{key:2,class:"absolute inset-0 bg-black pointer-events-none",style:u({opacity:(s.value.background_animated_overlay_opacity||0)/100})},null,4)):p("",!0)])):p("",!0)]),l("div",{class:"relative pt-6 overflow-y-auto z-10",style:u({...y(w),minHeight:"500px",maxHeight:"600px"})},[l("div",X,[_(C,{profile:m.value,organization:z.value,settings:s.value,"is-loaded":g.value},null,8,["profile","organization","settings","is-loaded"]),_($,{links:m.value.social_links,settings:s.value,"is-loaded":g.value},null,8,["links","settings","is-loaded"]),_(L,{links:m.value.custom_links,settings:s.value,"is-loaded":g.value},null,8,["links","settings","is-loaded"]),f.value.length>0||v.value.length>0?(c(),M(N,{key:0,products:f.value,categories:k.value,sections:v.value,settings:s.value,"is-loaded":g.value},null,8,["products","categories","sections","settings","is-loaded"])):p("",!0),l("div",G,[l("button",{class:"inline-flex items-center gap-2 px-6 py-2 rounded-lg text-sm font-medium text-white transition-all hover:scale-105",style:u({backgroundColor:s.value.primary_color})},[_(y(j),{class:"w-4 h-4"}),e[0]||(e[0]=V(" Guardar Contacto ",-1))],4)]),l("div",{class:"flex items-center justify-center gap-1 text-xs opacity-50 mt-4",style:u({color:s.value.text_secondary_color})},[_(y(B),{class:"w-3 h-3"}),e[1]||(e[1]=l("span",null,"Vista previa",-1))],4)])],4)]))}});export{Q as _};
